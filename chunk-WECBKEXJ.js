import{a as K}from"./chunk-IUHK7W7F.js";import{a as X}from"./chunk-CKNYBE3T.js";import{a as Y,b as $,d as J}from"./chunk-A2XKNEVR.js";import{d as h,e as V,f as q,g as L,h as G,i as B,j as R,n as W,o as H,p as U}from"./chunk-4WTB7YEB.js";import{c as j,e as Q}from"./chunk-G5FCKMJZ.js";import"./chunk-X32NUWCY.js";import"./chunk-GBL3DOWD.js";import{Ea as y,Kb as z,Mb as A,Na as f,O as u,Oa as _,Ra as w,Sa as E,T as S,Ta as C,U as P,Ua as n,Va as i,Wa as M,_a as O,ab as d,cb as p,ea as g,jb as x,lb as o,mb as b,nb as v,ob as k,qb as N,rb as I,sa as m,sb as F,wb as D,xb as T}from"./chunk-NOC6AZNP.js";var ne=(a,t)=>t.id;function ie(a,t){a&1&&(n(0,"span",30),o(1,"Attivo"),i())}function re(a,t){a&1&&(n(0,"span",31),o(1,"In Scadenza"),i())}function oe(a,t){a&1&&(n(0,"span",32),o(1,"Scaduto"),i())}function ae(a,t){a&1&&(n(0,"span",33),o(1,"Inattivo"),i())}function me(a,t){if(a&1&&(n(0,"div",38)(1,"span",39),o(2,"\u{1F4DE}"),i(),n(3,"span",40),o(4),i()()),a&2){let r=p().$implicit;m(4),b(r.phone)}}function le(a,t){if(a&1){let r=O();n(0,"div",26),d("click",function(){let l=S(r).$implicit,s=p(2);return P(s.goToDetail(l))}),n(1,"div",27)(2,"div",28),o(3),i(),n(4,"div",29),f(5,ie,2,0,"span",30)(6,re,2,0,"span",31)(7,oe,2,0,"span",32)(8,ae,2,0,"span",33),i()(),n(9,"div",34)(10,"h3",35),o(11),i(),n(12,"p",36),o(13),i(),n(14,"div",37)(15,"div",38)(16,"span",39),o(17,"\u{1F4C5}"),i(),n(18,"span",40),o(19),D(20,"date"),i()(),f(21,me,5,1,"div",38),i()(),n(22,"div",41)(23,"span",42),o(24," Vedi dettagli \u2192 "),i()()()}if(a&2){let r,e=t.$implicit,l=p(2);m(3),v(" ",l.getInitials(e)," "),m(2),_((r=l.getSubscriptionStatus(e))==="active"?5:r==="expiring"?6:r==="expired"?7:r==="inactive"?8:-1),m(6),k("",e.firstName," ",e.lastName),m(2),b(e.email),m(6),v("Iscritto ",T(20,7,e.joinedAt,"dd/MM/yyyy")),m(2),_(e.phone?21:-1)}}function se(a,t){if(a&1&&(n(0,"div",14),w(1,le,25,10,"div",25,ne),i()),a&2){let r=p();m(),E(r.filteredMembers())}}function de(a,t){if(a&1&&o(0),a&2){let r=p(2);v(' Nessun risultato per "',r.searchQuery,'" ')}}function ce(a,t){a&1&&o(0," Non ci sono ancora iscritti. Inizia aggiungendone uno! ")}function pe(a,t){if(a&1){let r=O();n(0,"app-button",5),d("clicked",function(){S(r);let l=p(2);return P(l.openAddModal())}),o(1," Aggiungi primo iscritto "),i()}}function be(a,t){if(a&1&&(n(0,"div",15)(1,"div",43),o(2,"\u{1F465}"),i(),n(3,"h3",44),o(4,"Nessun iscritto trovato"),i(),n(5,"p",45),f(6,de,1,1)(7,ce,1,0),i(),f(8,pe,2,0,"app-button"),i()),a&2){let r=p();m(6),_(r.searchQuery?6:7),m(2),_(r.searchQuery?-1:8)}}var Z=class a{memberService=u(X);subscriptionService=u(K);router=u(Q);route=u(j);fb=u(W);searchQuery="";filterStatus="all";isModalOpen=g(!1);isSubmitting=g(!1);allMembers=g([]);filteredMembers=g([]);subscriptions=g([]);memberForm=this.fb.group({firstName:["",[h.required]],lastName:["",[h.required]],email:["",[h.required,h.email]],phone:[""]});constructor(){this.refresh()}ngOnInit(){this.route.queryParams.subscribe(t=>{t.action==="add"&&(this.openAddModal(),this.router.navigate([],{relativeTo:this.route,queryParams:{action:null},queryParamsHandling:"merge"}))})}refresh(){this.subscriptionService.getSubscriptions().subscribe(t=>{this.subscriptions.set(t),this.memberService.getMembers().subscribe(r=>{this.allMembers.set(r),this.filterMembers()})})}filterMembers(){let t=this.allMembers();if(this.searchQuery){let r=this.searchQuery.toLowerCase();t=t.filter(e=>e.firstName.toLowerCase().includes(r)||e.lastName.toLowerCase().includes(r)||e.email.toLowerCase().includes(r))}this.filterStatus!=="all"&&(t=t.filter(r=>{let e=this.getSubscriptionStatus(r);return this.filterStatus==="active"?e==="active":this.filterStatus==="expiring"?e==="expiring":this.filterStatus==="expired"?e==="expired"||e==="inactive":!0})),this.filteredMembers.set(t)}setFilter(t){this.filterStatus=t,this.filterMembers()}getInitials(t){return(t.firstName[0]+t.lastName[0]).toUpperCase()}goToDetail(t){this.router.navigate(["/app/members",t.id])}openAddModal(){this.memberForm.reset(),this.isModalOpen.set(!0)}closeModal(){this.isModalOpen.set(!1)}onAddMember(){if(this.memberForm.invalid)return;this.isSubmitting.set(!0);let t=this.memberForm.value;this.memberService.addMember(t).subscribe({next:r=>{this.isSubmitting.set(!1),this.closeModal(),this.refresh()},error:r=>{this.isSubmitting.set(!1),alert("Errore durante l'aggiunta dell'iscritto")}})}get totalCount(){return this.allMembers().length}get activeCount(){return this.allMembers().filter(t=>this.getSubscriptionStatus(t)==="active").length}get expiringCount(){return this.allMembers().filter(t=>this.getSubscriptionStatus(t)==="expiring").length}get expiredCount(){return this.allMembers().filter(t=>{let r=this.getSubscriptionStatus(t);return r==="expired"||r==="inactive"}).length}getSubscriptionStatus(t){if(!t.subscriptionId)return"inactive";let r=this.subscriptions().find(te=>te.id===t.subscriptionId);if(!r)return"inactive";let e=new Date(t.joinedAt);e.setMonth(e.getMonth()+r.durationMonths);let l=new Date;l.setHours(0,0,0,0);let s=new Date(e);s.setHours(0,0,0,0);let c=new Date(s);if(c.setDate(c.getDate()+14),l>c)return"inactive";if(l>s)return"expired";let ee=10080*60*1e3;return s.getTime()-l.getTime()<=ee?"expiring":"active"}static \u0275fac=function(r){return new(r||a)};static \u0275cmp=y({type:a,selectors:[["app-members"]],decls:58,vars:20,consts:[[1,"members-container"],[1,"members-header"],[1,"header-top"],[1,"page-title"],[1,"page-subtitle"],[3,"clicked"],[1,"filters-section"],[1,"search-wrapper"],["type","search","placeholder","Cerca per nome, cognome o email...",3,"ngModelChange","ngModel"],[1,"filter-tabs"],[1,"filter-tab",3,"click"],[1,"tab-label"],[1,"tab-count"],[1,"members-content"],[1,"members-grid"],[1,"empty-state"],["title","Nuovo Iscritto","confirmLabel","Aggiungi",3,"close","confirm","isOpen","loading"],[1,"member-form",3,"formGroup"],[1,"form-row"],[1,"form-group","flex-1"],["placeholder","Es. Marco","formControlName","firstName",3,"error"],["placeholder","Es. Rossi","formControlName","lastName",3,"error"],[1,"form-group"],["type","email","placeholder","email@esempio.com","formControlName","email",3,"error"],["placeholder","333 1234567","formControlName","phone"],[1,"member-card"],[1,"member-card",3,"click"],[1,"member-card-header"],[1,"member-avatar"],[1,"member-status"],[1,"status-badge","active"],[1,"status-badge","expiring",2,"background-color","rgba(255, 193, 7, 0.15)","color","#FFC107","border","1px solid rgba(255, 193, 7, 0.3)"],[1,"status-badge","expired",2,"background-color","rgba(239, 83, 80, 0.15)","color","#EF5350","border","1px solid rgba(239, 83, 80, 0.3)"],[1,"status-badge","inactive"],[1,"member-card-body"],[1,"member-name"],[1,"member-email"],[1,"member-meta"],[1,"meta-item"],[1,"meta-icon"],[1,"meta-text"],[1,"member-card-footer"],[1,"view-details"],[1,"empty-icon"],[1,"empty-title"],[1,"empty-message"]],template:function(r,e){if(r&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),o(5,"Gestione Iscritti"),i(),n(6,"p",4),o(7,"Amministra i membri della tua palestra"),i()(),n(8,"app-button",5),d("clicked",function(){return e.openAddModal()}),n(9,"span"),o(10,"+"),i(),o(11," Nuovo Iscritto "),i()(),n(12,"div",6)(13,"div",7)(14,"app-input",8),F("ngModelChange",function(s){return I(e.searchQuery,s)||(e.searchQuery=s),s}),d("ngModelChange",function(){return e.filterMembers()}),i()(),n(15,"div",9)(16,"button",10),d("click",function(){return e.setFilter("all")}),n(17,"span",11),o(18,"Tutti"),i(),n(19,"span",12),o(20),i()(),n(21,"button",10),d("click",function(){return e.setFilter("active")}),n(22,"span",11),o(23,"Attivi"),i(),n(24,"span",12),o(25),i()(),n(26,"button",10),d("click",function(){return e.setFilter("expiring")}),n(27,"span",11),o(28,"In Scadenza"),i(),n(29,"span",12),o(30),i()(),n(31,"button",10),d("click",function(){return e.setFilter("expired")}),n(32,"span",11),o(33,"Scaduti"),i(),n(34,"span",12),o(35),i()()()()(),n(36,"div",13),f(37,se,3,0,"div",14)(38,be,9,2,"div",15),i(),n(39,"app-modal",16),d("close",function(){return e.closeModal()})("confirm",function(){return e.onAddMember()}),n(40,"form",17)(41,"div",18)(42,"div",19)(43,"label"),o(44,"Nome"),i(),M(45,"app-input",20),i(),n(46,"div",19)(47,"label"),o(48,"Cognome"),i(),M(49,"app-input",21),i()(),n(50,"div",22)(51,"label"),o(52,"Email"),i(),M(53,"app-input",23),i(),n(54,"div",22)(55,"label"),o(56,"Telefono"),i(),M(57,"app-input",24),i()()()()),r&2){let l,s,c;m(14),N("ngModel",e.searchQuery),m(2),x("active",e.filterStatus==="all"),m(4),b(e.totalCount),m(),x("active",e.filterStatus==="active"),m(4),b(e.activeCount),m(),x("active",e.filterStatus==="expiring"),m(4),b(e.expiringCount),m(),x("active",e.filterStatus==="expired"),m(4),b(e.expiredCount),m(2),_(e.filteredMembers().length>0?37:38),m(2),C("isOpen",e.isModalOpen())("loading",e.isSubmitting()),m(),C("formGroup",e.memberForm),m(5),C("error",(l=e.memberForm.get("firstName"))!=null&&l.touched&&((l=e.memberForm.get("firstName"))!=null&&l.invalid)?"Il nome \xE8 obbligatorio":void 0),m(4),C("error",(s=e.memberForm.get("lastName"))!=null&&s.touched&&((s=e.memberForm.get("lastName"))!=null&&s.invalid)?"Il cognome \xE8 obbligatorio":void 0),m(4),C("error",(c=e.memberForm.get("email"))!=null&&c.touched&&((c=e.memberForm.get("email"))!=null&&c.invalid)?"Inserisci un'email valida":void 0)}},dependencies:[A,H,G,V,q,L,U,R,B,Y,$,J,z],styles:[".members-container[_ngcontent-%COMP%]{background:#c7d6d5;min-height:100vh;padding:2rem}.members-header[_ngcontent-%COMP%]{margin-bottom:2rem}.header-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;background:#fff9;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border:1px solid rgba(0,0,0,.08);border-radius:1rem;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 4px 12px #0000000a}.page-title[_ngcontent-%COMP%]{font-size:1.875rem;font-weight:700;color:#1a1d21;margin:0 0 .25rem}.page-subtitle[_ngcontent-%COMP%]{font-size:1rem;color:#4a5568;margin:0}.filters-section[_ngcontent-%COMP%]{background:#fff9;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px);border:1px solid rgba(0,0,0,.08);border-radius:1rem;padding:1.5rem;box-shadow:0 4px 12px #0000000a}.search-wrapper[_ngcontent-%COMP%]{margin-bottom:1.25rem}.filter-tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;background:#00000005;padding:.5rem;border-radius:.75rem}.filter-tab[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.75rem 1.25rem;border-radius:.5rem;background:transparent;border:none;color:#4a5568;font-weight:600;font-size:.875rem;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1)}.filter-tab[_ngcontent-%COMP%]:hover{background:#ffffff80;color:#1a1d21}.filter-tab.active[_ngcontent-%COMP%]{background:#fff;color:#3066be;box-shadow:0 4px 8px #0000000f}.filter-tab.active[_ngcontent-%COMP%]   .tab-count[_ngcontent-%COMP%]{background:#3066be;color:#fff}.tab-label[_ngcontent-%COMP%]{font-size:.875rem}.tab-count[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;min-width:24px;height:24px;padding:0 .5rem;background:#0000000f;border-radius:9999px;font-size:11px;font-weight:700;transition:all .3s}.members-content[_ngcontent-%COMP%]{min-height:400px}.members-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.5rem}.member-card[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(0,0,0,.08);border-radius:.75rem;padding:1.5rem;cursor:pointer;transition:all .3s cubic-bezier(.4,0,.2,1);box-shadow:0 4px 6px #00000005}.member-card[_ngcontent-%COMP%]:hover{transform:translateY(-4px);box-shadow:0 12px 24px #00000014;border-color:#3066be}.member-card[_ngcontent-%COMP%]:hover   .member-avatar[_ngcontent-%COMP%]{transform:scale(1.05);box-shadow:0 8px 16px #0003}.member-card[_ngcontent-%COMP%]:hover   .view-details[_ngcontent-%COMP%]{color:#3066be;transform:translate(4px)}.member-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1.25rem}.member-avatar[_ngcontent-%COMP%]{width:56px;height:56px;border-radius:9999px;background:linear-gradient(135deg,#e71d36,#3066be);display:flex;align-items:center;justify-content:center;font-size:1.25rem;font-weight:700;color:#fff;box-shadow:0 6px 12px #0000001f;transition:all .3s}.member-status[_ngcontent-%COMP%]{display:flex}.status-badge[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:9999px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;border:2px solid}.status-badge.active[_ngcontent-%COMP%]{background:#10b9811a;color:#10b981;border-color:#10b9814d}.status-badge.expired[_ngcontent-%COMP%]{background:#e71d361a;color:#e71d36;border-color:#e71d364d}.status-badge.expiring[_ngcontent-%COMP%]{background:#f59e0b1a;color:#f59e0b;border-color:#f59e0b4d}.status-badge.inactive[_ngcontent-%COMP%]{background:#4a55681a;color:#4a5568;border-color:#4a55684d}.member-card-body[_ngcontent-%COMP%]{margin-bottom:1.25rem}.member-name[_ngcontent-%COMP%]{font-size:1.25rem;font-weight:700;color:#1a1d21;margin:0 0 .25rem}.member-email[_ngcontent-%COMP%]{font-size:.875rem;color:#4a5568;margin:0 0 1rem}.member-meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.875rem;color:#4a5568}.meta-icon[_ngcontent-%COMP%]{font-size:16px;opacity:.7}.meta-text[_ngcontent-%COMP%]{font-size:.75rem}.member-card-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding-top:1rem;border-top:1px solid rgba(0,0,0,.08)}.view-details[_ngcontent-%COMP%]{font-size:.875rem;font-weight:700;color:#4a5568;transition:all .3s}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:4rem 2rem;text-align:center;background:#fff6;border:2px dashed rgba(0,0,0,.08);border-radius:1rem}.empty-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:1.25rem;opacity:.5}.empty-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#1a1d21;margin:0 0 .5rem}.empty-message[_ngcontent-%COMP%]{font-size:1rem;color:#4a5568;margin:0 0 1.5rem;max-width:400px}@media(max-width:768px){.members-container[_ngcontent-%COMP%]{padding:1rem}.header-top[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:stretch}.header-top[_ngcontent-%COMP%]   app-button[_ngcontent-%COMP%]{width:100%}.members-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.filter-tabs[_ngcontent-%COMP%]{flex-direction:column}.filter-tab[_ngcontent-%COMP%]{justify-content:space-between}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.member-card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .4s ease-out backwards}.member-card[_ngcontent-%COMP%]:nth-child(1){animation-delay:.05s}.member-card[_ngcontent-%COMP%]:nth-child(2){animation-delay:.1s}.member-card[_ngcontent-%COMP%]:nth-child(3){animation-delay:.15s}.member-card[_ngcontent-%COMP%]:nth-child(4){animation-delay:.2s}.member-card[_ngcontent-%COMP%]:nth-child(5){animation-delay:.25s}.member-card[_ngcontent-%COMP%]:nth-child(6){animation-delay:.3s}.member-card[_ngcontent-%COMP%]:nth-child(7){animation-delay:.35s}.member-card[_ngcontent-%COMP%]:nth-child(8){animation-delay:.4s}.member-card[_ngcontent-%COMP%]:nth-child(9){animation-delay:.45s}.member-card[_ngcontent-%COMP%]:nth-child(10){animation-delay:.5s}.member-card[_ngcontent-%COMP%]:nth-child(11){animation-delay:.55s}.member-card[_ngcontent-%COMP%]:nth-child(12){animation-delay:.6s}.member-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.member-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}@media(max-width:640px){.member-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column}}.member-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.member-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:#4a5568}"]})};export{Z as MembersComponent};
