import{e as h}from"./chunk-G5FCKMJZ.js";import{a as p}from"./chunk-X32NUWCY.js";import{a as d}from"./chunk-GBL3DOWD.js";import{F as c,J as m,O as s,ea as u,j as n,y as l,zb as g}from"./chunk-NOC6AZNP.js";var U=class i{router=s(h);storage=s(d);mockData=s(p);_currentUser=u(null);_isAuthenticated=g(()=>!!this._currentUser());currentUser=this._currentUser.asReadonly();isAuthenticated=this._isAuthenticated;constructor(){this.initializeData(),this.restoreSession()}initializeData(){this.storage.getItem("users")||(this.storage.setItem("users",this.mockData.getInitialUsers()),this.storage.setItem("gyms",[this.mockData.getInitialGym()]),this.storage.setItem("courses",this.mockData.getInitialCourses()),this.storage.setItem("subscriptions",this.mockData.getInitialSubscriptions()),console.log("Mock Data Initialized"))}restoreSession(){let e=this.storage.getItem("currentUser");e&&this._currentUser.set(e)}login(e,o){return n(!0).pipe(l(800),c(()=>{let t=(this.storage.getItem("users")||[]).find(a=>a.email.toLowerCase()===e.toLowerCase());if(t)this._currentUser.set(t),this.storage.setItem("currentUser",t),this.redirectBasedOnRole(t.role);else throw new Error("Invalid credentials")}))}register(e,o){return n(!0).pipe(l(1e3),c(()=>{let r=this.storage.getItem("users")||[];if(r.find(a=>a.email.toLowerCase()===e.email?.toLowerCase()))throw new Error("Email already exists");let t={id:`user-${Date.now()}`,email:e.email,firstName:e.firstName,lastName:e.lastName,role:e.role,gymId:e.gymId||null,avatar:null,createdAt:new Date};e.role==="manager"&&e.gymId,r.push(t),this.storage.setItem("users",r),this._currentUser.set(t),this.storage.setItem("currentUser",t),this.redirectBasedOnRole(t.role)}))}logout(){this._currentUser.set(null),this.storage.removeItem("currentUser"),this.router.navigate(["/auth/login"])}redirectBasedOnRole(e){e==="manager"?this.router.navigate(["/app/dashboard"]):this.router.navigate(["/app/dashboard"])}hasRole(e){return this.currentUser()?.role===e}static \u0275fac=function(o){return new(o||i)};static \u0275prov=m({token:i,factory:i.\u0275fac,providedIn:"root"})};export{U as a};
