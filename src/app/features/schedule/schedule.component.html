<div class="schedule-container h-full flex flex-col">
  <!-- Header Section with Month/Year Selection -->
  <header class="schedule-header">
    <div class="header-top">
      <div class="date-selectors">
        <select [ngModel]="selectedMonth()" (ngModelChange)="selectedMonth.set(+$event); onMonthYearChange()"
          class="month-select">
          @for (monthName of monthNames; track monthName; let i = $index) {
          <option [value]="i">{{ monthName }}</option>
          }
        </select>

        <select [ngModel]="selectedYear()" (ngModelChange)="selectedYear.set(+$event); onMonthYearChange()"
          class="year-select">
          @for (year of years; track year) {
          <option [value]="year">{{ year }}</option>
          }
        </select>
      </div>
    </div>

    <!-- 7 Day Cards Strip -->
    <div class="date-strip no-scrollbar">
      @for (day of weekDays(); track day.date) {
      <button class="date-card" [class.active]="selectedDate()?.date === day.date" (click)="selectDate(day)">
        <span class="day-name">{{ day.dayName }}</span>
        <span class="day-number">{{ day.dayNumber }}</span>
        @if (day.isToday) {
        <span class="today-dot"></span>
        }
      </button>
      }
    </div>
  </header>

  <!-- Main Content Layout (Daily Timeline) -->
  <main class="schedule-content">
    <div class="content-max-width">
      @if (selectedDate(); as selected) {
      <div class="day-brief animate-enter">
        <div class="day-title">
          <h2 class="full-date">{{ dayLabels[selected.fullDay] }} {{ selected.dayNumber }} {{
            monthNames[selected.date.getMonth()] }}</h2>
          <span class="current-time">Palinsesto odierno</span>
        </div>
        <button class="add-btn" (click)="openAddModal()" aria-label="Aggiungi corso">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M12 5v14M5 12h14" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
      </div>

      <!-- Timeline List -->
      <div class="timeline-list animate-enter-staggered">
        @for (slot of dailySlots(); track slot.courseId + slot.timeStart) {
        <div class="timeline-item">
          <div class="time-marker">
            <span class="marker-dot"></span>
            <span class="marker-line"></span>
          </div>

          <div class="course-card" [class]="slot.colorClass" (click)="onSlotClick(slot)">
            <div class="card-glass"></div>
            <div class="card-content">
              <div class="card-header">
                <h3 class="course-name">{{ slot.name }}</h3>
              </div>

              <div class="card-footer">
                <div class="footer-item">
                  <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <circle cx="12" cy="12" r="10" stroke-width="2" />
                    <path d="M12 6v6l4 2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                  <span>{{ slot.timeStart }} - {{ slot.timeEnd }}</span>
                </div>
                <div class="footer-item">
                  <span class="instructor-tag">Istr. {{ slot.instructor }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        } @empty {
        <div class="empty-state">
          <div class="empty-icon">ðŸŽ¨</div>
          <p>Nessun corso in programma per questo giorno</p>
        </div>
        }
      </div>
      }
    </div>
  </main>

  <app-modal [isOpen]="isBookingModalOpen()" title="Doyou want to join?" confirmLabel="Prenota Posto"
    [loading]="bookingLoading()" (close)="closeBookingModal()" (confirm)="confirmBooking()">
    @if (selectedSlot) {
    <div class="flex flex-col gap-4">
      <div class="flex items-center gap-4 p-3 bg-gray-800 rounded-lg">
        <div class="w-12 h-12 rounded-full bg-accent text-white flex items-center justify-center text-xl font-bold">
          {{ selectedSlot.name.charAt(0) }}
        </div>
        <div>
          <h4 class="font-bold text-lg text-white">{{ selectedSlot.name }}</h4>
          <p class="text-sm text-gray-400">Istr. {{ selectedSlot.instructor }}</p>
        </div>
      </div>
      <p class="text-gray-300">Confermi la tua prenotazione per questo corso?</p>
    </div>
    }
  </app-modal>
</div>