<div class="main-layout" [class.sidebar-collapsed]="isSidebarCollapsed()">
  <!-- Sidebar -->
  <aside class="sidebar" [class.mobile-open]="isMobileMenuOpen()">
    <!-- Logo & Brand -->
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-icon">ü•ä</div>
        @if (!isSidebarCollapsed()) {
        <div class="logo-text">
          <span class="logo-title">Pound for Pound</span>
          <span class="logo-subtitle">Management</span>
        </div>
        }
      </div>

      <!-- Desktop Toggle -->
      <button class="sidebar-toggle desktop-only" (click)="toggleSidebar()">
        @if (isSidebarCollapsed()) {
        <span>‚Üí</span>
        } @else {
        <span>‚Üê</span>
        }
      </button>
    </div>


    <!-- Navigation Menu -->
    <nav class="nav-menu">
      @for (item of menuItems; track item.route) {
      <a [routerLink]="item.route" routerLinkActive="active" class="nav-item" (click)="closeMobileMenu()">
        <span class="nav-icon">{{ item.icon }}</span>
        @if (!isSidebarCollapsed()) {
        <div class="nav-content">
          <span class="nav-label">{{ item.label }}</span>
          <span class="nav-description">{{ item.description }}</span>
        </div>
        }
      </a>
      }
    </nav>

  </aside>

  <!-- Mobile Overlay -->
  @if (isMobileMenuOpen()) {
  <div class="mobile-overlay" (click)="closeMobileMenu()"></div>
  }

  <!-- Main Content -->
  <main class="main-content">
    <!-- Mobile Header -->
    <header class="mobile-header">
      <button class="mobile-menu-btn" (click)="toggleMobileMenu()">
        <span class="hamburger-icon">‚ò∞</span>
      </button>
      <div class="mobile-logo">
        <span class="mobile-logo-icon">ü•ä</span>
        <span class="mobile-logo-text">Pound for Pound</span>
      </div>
      <div class="mobile-actions">
        <button class="notif-btn" (click)="toggleNotifications()" [class.active]="isNotificationsOpen()">
          <span class="notif-icon">üîî</span>
          @if (unreadCount() > 0) {
          <span class="notif-badge">{{ unreadCount() }}</span>
          }
        </button>
        <div class="mobile-avatar" (click)="toggleUserMenu()" [class.active]="isUserMenuOpen()">
          {{ userInitials() }}
        </div>
      </div>
    </header>

    <!-- Desktop Top Bar -->
    <header class="desktop-header desktop-only">
      <div class="header-search">
        <!-- Eventuale barra di ricerca futura -->
      </div>
      <div class="header-actions">
        <button class="notif-btn" (click)="toggleNotifications()" [class.active]="isNotificationsOpen()">
          <span class="notif-icon">üîî</span>
          @if (unreadCount() > 0) {
          <span class="notif-badge">{{ unreadCount() }}</span>
          }
        </button>

        <div class="header-user" (click)="toggleUserMenu()" [class.active]="isUserMenuOpen()">
          <div class="user-avatar header-avatar">
            {{ userInitials() }}
          </div>
          <div class="user-info header-info">
            <div class="user-name">{{ currentUser()?.firstName }} {{ currentUser()?.lastName }}</div>
            <div class="user-role">{{ currentUser()?.role === 'manager' ? 'Gestore' : 'Atleta' }}</div>
          </div>
          <span class="dropdown-icon" [class.rotate]="isUserMenuOpen()">‚ñº</span>
        </div>
      </div>
    </header>

    <!-- User Menu Dropdown -->
    @if (isUserMenuOpen()) {
    <div class="user-dropdown">
      <div class="user-dropdown-header">
        <div class="dropdown-avatar">{{ userInitials() }}</div>
        <div class="dropdown-user-info">
          <div class="dropdown-name">{{ currentUser()?.firstName }} {{ currentUser()?.lastName }}</div>
          <div class="dropdown-email">{{ currentUser()?.email }}</div>
        </div>
      </div>
      <div class="user-dropdown-content">
        <a routerLink="/app/settings" class="dropdown-item" (click)="closeUserMenu()">
          <span class="item-icon">‚öôÔ∏è</span>
          <div class="item-text">
            <span class="item-label">Impostazioni</span>
            <span class="item-desc">Gestisci il tuo profilo e preferenze</span>
          </div>
        </a>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item logout" (click)="logout(); closeUserMenu()">
          <span class="item-icon">üö™</span>
          <div class="item-text">
            <span class="item-label">Esci</span>
            <span class="item-desc">Termina la sessione corrente</span>
          </div>
        </button>
      </div>
    </div>
    }

    <!-- Notifications Dropdown (Global) -->
    @if (isNotificationsOpen()) {
    <div class="notif-dropdown">
      <div class="notif-header">
        <h3 class="notif-title">Notifiche</h3>
        @if (unreadCount() > 0) {
        <button class="mark-all-btn" (click)="markAllAsRead()">Segna tutte come lette</button>
        }
      </div>
      <div class="notif-list">
        @for (notif of notifications(); track notif.id) {
        <div class="notif-item" [class.unread]="!notif.isRead" [class]="notif.type" (click)="markAsRead(notif)">
          <div class="notif-item-icon">
            @if (notif.type === 'success') { ‚úÖ }
            @else if (notif.type === 'warning') { ‚ö†Ô∏è }
            @else if (notif.type === 'error') { ‚ùå }
            @else { ‚ÑπÔ∏è }
          </div>
          <div class="notif-content-wrapper">
            <div class="notif-item-title">{{ notif.title }}</div>
            <div class="notif-item-message">{{ notif.message }}</div>
            <div class="notif-item-time">{{ notif.timestamp | date:'HH:mm' }}</div>
          </div>
          <button class="notif-delete-btn" (click)="deleteNotification(notif); $event.stopPropagation()">‚úï</button>
        </div>
        } @empty {
        <div class="notif-empty">
          <span class="empty-icon">üì≠</span>
          <p>Non hai nuove notifiche</p>
        </div>
        }
      </div>
    </div>
    }

    <!-- Page Content -->
    <div class="page-content">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>